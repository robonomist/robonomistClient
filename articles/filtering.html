<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filtering large data tables • robonomistClient</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filtering large data tables">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-133826983-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-133826983-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">robonomistClient</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.20</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_features.html">Basic features</a></li>
    <li><a class="dropdown-item" href="../articles/examples.html">Examples</a></li>
    <li><a class="dropdown-item" href="../articles/filtering.html">Filtering large data tables</a></li>
    <li><a class="dropdown-item" href="../articles/special.html">Special datasources</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/robonomist/robonomistClient/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Filtering large data tables</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/robonomist/robonomistClient/blob/main/vignettes/filtering.Rmd" class="external-link"><code>vignettes/filtering.Rmd</code></a></small>
      <div class="d-none name"><code>filtering.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="filtering-datasources">Filtering datasources<a class="anchor" aria-label="anchor" href="#filtering-datasources"></a>
</h2>
<p>Most data tables are returned as regular <code>tibble</code> objects,
but some datasources contain large tables and require filtering at the
source. For example, OECD database usually requires filtering on the
data before anything can be retrieved. For convenience, Robonomist
provides an easy-to-use workflow to fetch data.</p>
<blockquote>
<p>The OECD SDMX-ML api, on which the <code>oecd</code> dataset is
based, has become unstable recently. We recommened to using the new
<code>oecd3</code> database, which uses the SDMX-json api which is more
reliable.</p>
</blockquote>
<p>The initial data request (e.g <code>data("oecd3/QNA")</code>) returns
a data structure object that acts very much like a regular tibble, but
it does not yet contain the actual data. This object is printed like a
tibble, and it can be handled with common <code>dplyr</code> verbs such
as <code>filter</code> and <code>distinct</code> in a
<code>magrittr</code> pipe using <code>%&gt;%</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/data.html">data</a></span><span class="op">(</span><span class="st">"oecd3/QNA"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Title:    Quarterly National Accounts</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># OECD_v3:  Uncollected data structure</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,646,536 × 6</span></span></span>
<span><span class="co">#&gt;    Country Subject              Measure           Frequency time           value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;collect&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Finland Net purchases abroad National currenc… Quarterly 1990-01-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Finland Net purchases abroad National currenc… Quarterly 1990-04-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Finland Net purchases abroad National currenc… Quarterly 1990-07-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Finland Net purchases abroad National currenc… Quarterly 1990-10-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Finland Net purchases abroad National currenc… Quarterly 1991-01-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Finland Net purchases abroad National currenc… Quarterly 1991-04-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Finland Net purchases abroad National currenc… Quarterly 1991-07-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Finland Net purchases abroad National currenc… Quarterly 1991-10-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Finland Net purchases abroad National currenc… Quarterly 1992-01-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Finland Net purchases abroad National currenc… Quarterly 1992-04-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3,646,526 more rows</span></span></span>
<span><span class="co">#&gt; # This data has not yet been collected from OECD api, and all rows might not be available. Please use `filter()` to limit the number of rows under a million, and use `collect()` to retrieve actual data.</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/data.html">data</a></span><span class="op">(</span><span class="st">"oecd3/QNA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"Finland"</span>,</span>
<span>         <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">Subject</span>, <span class="st">"Gross domestic prod"</span><span class="op">)</span>,</span>
<span>         <span class="va">Frequency</span><span class="op">==</span><span class="st">"Quarterly"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2019L</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Title:    Quarterly National Accounts</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># OECD_v3:  Uncollected data structure</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 390 × 6</span></span></span>
<span><span class="co">#&gt;    Country Subject                        Measure Frequency time           value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;collect&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Finland Gross domestic product at mar… Nation… Quarterly 2020-01-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Finland Gross domestic product at mar… Nation… Quarterly 2020-04-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Finland Gross domestic product at mar… Nation… Quarterly 2020-07-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Finland Gross domestic product at mar… Nation… Quarterly 2020-10-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Finland Gross domestic product at mar… Nation… Quarterly 2021-01-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Finland Gross domestic product at mar… Nation… Quarterly 2021-04-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Finland Gross domestic product at mar… Nation… Quarterly 2021-07-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Finland Gross domestic product at mar… Nation… Quarterly 2021-10-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Finland Gross domestic product at mar… Nation… Quarterly 2022-01-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Finland Gross domestic product at mar… Nation… Quarterly 2022-04-01        ??</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 380 more rows</span></span></span>
<span><span class="co">#&gt; # This data has not yet been collected from OECD api, and all rows might not be available. Please use `filter()` to limit the number of rows under a million, and use `collect()` to retrieve actual data.</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">Subject</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 1</span></span></span>
<span><span class="co">#&gt;   Subject                                                  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Gross domestic product at market prices - output approach</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Gross domestic product - expenditure approach            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Gross domestic product - income approach                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Gross domestic product</span></span></code></pre></div>
<p>After data structure object has been filtered, the actual data can be
collected with <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Robonomist id: </span><span style="color: #00BBBB;">oecd3/QNA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Title:         Quarterly National Accounts</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Vintage:       2024-06-13 05:31:05.142084</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble:      390 × 6</span></span></span>
<span><span class="co">#&gt;    Country Subject                            Measure Frequency time       value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Finland Gross domestic product at market … Nation… Quarterly 2020-01-01 <span style="text-decoration: underline;">58</span>424</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Finland Gross domestic product at market … Nation… Quarterly 2020-04-01 <span style="text-decoration: underline;">57</span>751</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Finland Gross domestic product at market … Nation… Quarterly 2020-07-01 <span style="text-decoration: underline;">59</span>082</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Finland Gross domestic product at market … Nation… Quarterly 2020-10-01 <span style="text-decoration: underline;">62</span>781</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Finland Gross domestic product at market … Nation… Quarterly 2021-01-01 <span style="text-decoration: underline;">57</span>665</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Finland Gross domestic product at market … Nation… Quarterly 2021-04-01 <span style="text-decoration: underline;">62</span>729</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Finland Gross domestic product at market … Nation… Quarterly 2021-07-01 <span style="text-decoration: underline;">62</span>551</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Finland Gross domestic product at market … Nation… Quarterly 2021-10-01 <span style="text-decoration: underline;">67</span>719</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Finland Gross domestic product at market … Nation… Quarterly 2022-01-01 <span style="text-decoration: underline;">62</span>705</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Finland Gross domestic product at market … Nation… Quarterly 2022-04-01 <span style="text-decoration: underline;">67</span>312</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 380 more rows</span></span></span></code></pre></div>
<p>Also common <code>dplyr</code> verbs that require the actual data
will trigger the <code>collect</code> function automatically.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/data.html">data</a></span><span class="op">(</span><span class="st">"oecd3/QNA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Subject</span> <span class="op">==</span> <span class="st">"Gross domestic product - expenditure approach"</span>,</span>
<span>         <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">Measure</span>, <span class="st">"Growth rate.*year"</span><span class="op">)</span>,</span>
<span>         <span class="va">Frequency</span> <span class="op">==</span> <span class="st">"Quarterly"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2015</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>`Average Q/Q growth rate` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 58 × 2</span></span></span>
<span><span class="co">#&gt;    Country                      `Average Q/Q growth rate`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Argentina                                        0.503</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Australia                                        2.41 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Austria                                          1.26 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Belgium                                          1.70 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Brazil                                           0.542</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Bulgaria                                         2.84 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Canada                                           1.64 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Chile                                            2.11 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> China (People's Republic of)                     5.86 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Colombia                                         2.80 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 48 more rows</span></span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Juha Itkonen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
