<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filtering large data tables • robonomistClient</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Filtering large data tables">
<meta property="og:description" content="robonomistClient">
<meta property="og:image" content="https://robonomist.github.io/robonomistClient/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-133826983-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-133826983-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">robonomistClient</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic_features.html">Basic features</a>
    </li>
    <li>
      <a href="../articles/examples.html">Examples</a>
    </li>
    <li>
      <a href="../articles/filtering.html">Filtering large data tables</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robonomist/robonomistClient/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="filtering_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Filtering large data tables</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/robonomist/robonomistClient/blob/master/vignettes/filtering.Rmd"><code>vignettes/filtering.Rmd</code></a></small>
      <div class="hidden name"><code>filtering.Rmd</code></div>

    </div>

    
    
<div id="filtering-datasources" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-datasources" class="anchor"></a>Filtering datasources</h2>
<p>Most data tables are returned as regular <code>tibble</code> objects, but some datasources contain large tables and require filtering at the source. For example, OECD database usually requires filtering on the data before anything can be retrieved. For convenience, Robonomist provides an easy-to-use workflow to fetch data.</p>
<p>The initial data request (e.g <code><a href="../reference/data.html">data("oecd/QNA")</a></code>) returns a data structure object that acts very much like a regular tibble, but it does not yet contain the actual data. This object is printed like a tibble, and it can be handled with common <code>dplyr</code> verbs such as <code>filter</code> and <code>distinct</code> in a <code>magrittr</code> pipe using <code>%&gt;%</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/data.html">data</a></span><span class="op">(</span><span class="st">"oecd/QNA"</span><span class="op">)</span>
<span class="co">#&gt; # Robonomist id: oecd/QNA</span>
<span class="co">#&gt; # OECD:          Uncollected data structure</span>
<span class="co">#&gt; # Title:         Quarterly National Accounts</span>
<span class="co">#&gt;    Country   Subject                Measure        Frequency time           value</span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;                  &lt;chr&gt;          &lt;chr&gt;     &lt;date&gt;     &lt;collect&gt;</span>
<span class="co">#&gt;  1 Australia Gross domestic product Current prices Annual    1947-01-01        ??</span>
<span class="co">#&gt;  2 Australia Gross domestic product Current prices Quarterly 1947-01-01        ??</span>
<span class="co">#&gt;  3 Australia Gross domestic product Current prices Quarterly 1947-04-01        ??</span>
<span class="co">#&gt;  4 Australia Gross domestic product Current prices Quarterly 1947-07-01        ??</span>
<span class="co">#&gt;  5 Australia Gross domestic product Current prices Quarterly 1947-10-01        ??</span>
<span class="co">#&gt;  6 Australia Gross domestic product Current prices Annual    1948-01-01        ??</span>
<span class="co">#&gt;  7 Australia Gross domestic product Current prices Quarterly 1948-01-01        ??</span>
<span class="co">#&gt;  8 Australia Gross domestic product Current prices Quarterly 1948-04-01        ??</span>
<span class="co">#&gt;  9 Australia Gross domestic product Current prices Quarterly 1948-07-01        ??</span>
<span class="co">#&gt; 10 Australia Gross domestic product Current prices Quarterly 1948-10-01        ??</span>
<span class="co">#&gt; # … with 182,244,806 more rows</span>
<span class="co">#&gt; # This data has not yet been collected from OECD api, and all rows might not be available. Please use `filter` to limit the number of rows under a million,  and use `collect` to retrieve actual data.</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/data.html">data</a></span><span class="op">(</span><span class="st">"oecd/QNA"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"Finland"</span>,
         <span class="fu">str_detect</span><span class="op">(</span><span class="va">Subject</span>, <span class="st">"Gross domestic prod"</span><span class="op">)</span>,
         <span class="va">Frequency</span><span class="op">==</span><span class="st">"Quarterly"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2019L</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; # Robonomist id: oecd/QNA</span>
<span class="co">#&gt; # OECD:          Uncollected data structure</span>
<span class="co">#&gt; # Title:         Quarterly National Accounts</span>
<span class="co">#&gt;    Country Subject                Measure         Frequency time           value</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;                  &lt;chr&gt;           &lt;chr&gt;     &lt;date&gt;     &lt;collect&gt;</span>
<span class="co">#&gt;  1 Finland Gross domestic product Current prices  Quarterly 2020-01-01        ??</span>
<span class="co">#&gt;  2 Finland Gross domestic product National curre… Quarterly 2020-01-01        ??</span>
<span class="co">#&gt;  3 Finland Gross domestic product Current prices  Quarterly 2020-04-01        ??</span>
<span class="co">#&gt;  4 Finland Gross domestic product National curre… Quarterly 2020-04-01        ??</span>
<span class="co">#&gt;  5 Finland Gross domestic product Current prices  Quarterly 2020-07-01        ??</span>
<span class="co">#&gt;  6 Finland Gross domestic product National curre… Quarterly 2020-07-01        ??</span>
<span class="co">#&gt;  7 Finland Gross domestic product Current prices  Quarterly 2020-10-01        ??</span>
<span class="co">#&gt;  8 Finland Gross domestic product National curre… Quarterly 2020-10-01        ??</span>
<span class="co">#&gt;  9 Finland Gross domestic product Current prices  Quarterly 2021-01-01        ??</span>
<span class="co">#&gt; 10 Finland Gross domestic product National curre… Quarterly 2021-01-01        ??</span>
<span class="co">#&gt; # … with 1,286 more rows</span>
<span class="co">#&gt; # This data has not yet been collected from OECD api, and all rows might not be available. Please use `filter` to limit the number of rows under a million,  and use `collect` to retrieve actual data.</span>

<span class="fu">distinct</span><span class="op">(</span><span class="va">x</span>, <span class="va">Subject</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 1</span>
<span class="co">#&gt;   Subject                                                  </span>
<span class="co">#&gt;   &lt;chr&gt;                                                    </span>
<span class="co">#&gt; 1 Gross domestic product                                   </span>
<span class="co">#&gt; 2 Gross domestic product - expenditure approach            </span>
<span class="co">#&gt; 3 Gross domestic product - income approach                 </span>
<span class="co">#&gt; 4 Gross domestic product at market prices - output approach</span>
<span class="co">#&gt; 5 Gross domestic product at market prices - output approach</span>
<span class="co">#&gt; 6 Gross domestic product</span></code></pre></div>
<p>After data structure object has been filtered, the actual data can be collected with <code>collect()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">%&gt;%</span> <span class="fu">collect</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # Robonomist id: oecd/QNA</span>
<span class="co">#&gt; # A tibble:      133 × 11</span>
<span class="co">#&gt; # Title:         Quarterly National Accounts</span>
<span class="co">#&gt;    Country Subject     Measure    Frequency time       value `Time Format` Unit </span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;</span>
<span class="co">#&gt;  1 Finland Gross dome… National … Quarterly 2020-01-01 58222 Quarterly     Euro </span>
<span class="co">#&gt;  2 Finland Gross dome… National … Quarterly 2020-04-01 57423 Quarterly     Euro </span>
<span class="co">#&gt;  3 Finland Gross dome… National … Quarterly 2020-07-01 58512 Quarterly     Euro </span>
<span class="co">#&gt;  4 Finland Gross dome… National … Quarterly 2020-10-01 62031 Quarterly     Euro </span>
<span class="co">#&gt;  5 Finland Gross dome… National … Quarterly 2021-01-01 57641 Quarterly     Euro </span>
<span class="co">#&gt;  6 Finland Gross dome… National … Quarterly 2020-01-01 60429 Quarterly     Euro </span>
<span class="co">#&gt;  7 Finland Gross dome… National … Quarterly 2020-04-01 57015 Quarterly     Euro </span>
<span class="co">#&gt;  8 Finland Gross dome… National … Quarterly 2020-07-01 59281 Quarterly     Euro </span>
<span class="co">#&gt;  9 Finland Gross dome… National … Quarterly 2020-10-01 59463 Quarterly     Euro </span>
<span class="co">#&gt; 10 Finland Gross dome… National … Quarterly 2021-01-01 60073 Quarterly     Euro </span>
<span class="co">#&gt; # … with 123 more rows, and 3 more variables: Unit multiplier &lt;chr&gt;,</span>
<span class="co">#&gt; #   Reference period &lt;chr&gt;, Observation Status &lt;chr&gt;</span></code></pre></div>
<p>Also common <code>dplyr</code> verbs that require the actual data will trigger the <code>collect</code> function automatically.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/data.html">data</a></span><span class="op">(</span><span class="st">"oecd/QNA"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Subject</span> <span class="op">==</span> <span class="st">"Gross domestic product - expenditure approach"</span>,
         <span class="fu">str_detect</span><span class="op">(</span><span class="va">Measure</span>, <span class="st">"Growth rate.*from previous"</span><span class="op">)</span>,
         <span class="va">Frequency</span><span class="op">==</span><span class="st">"Quarterly"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2015L</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">Country</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>`Average Q/Q growth rate` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 57 × 2</span>
<span class="co">#&gt;    Country                      `Average Q/Q growth rate`</span>
<span class="co">#&gt;    &lt;chr&gt;                                            &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Argentina                                      -0.0551</span>
<span class="co">#&gt;  2 Australia                                       0.538 </span>
<span class="co">#&gt;  3 Austria                                         0.276 </span>
<span class="co">#&gt;  4 Belgium                                         0.295 </span>
<span class="co">#&gt;  5 Brazil                                         -0.0488</span>
<span class="co">#&gt;  6 Bulgaria                                        0.671 </span>
<span class="co">#&gt;  7 Canada                                          0.318 </span>
<span class="co">#&gt;  8 Chile                                           0.473 </span>
<span class="co">#&gt;  9 China (People's Republic of)                    1.58  </span>
<span class="co">#&gt; 10 Colombia                                        0.424 </span>
<span class="co">#&gt; # … with 47 more rows</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Juha Itkonen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
